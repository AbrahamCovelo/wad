var Wad=function(){var e=window.AudioContext||window.webkitAudioContext;var t=new e;getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.getUserMedia;if(getUserMedia){getUserMedia=getUserMedia.bind(navigator)}else{}var n=function(){Math.seed=6;Math.seededRandom=function(e,t){e=e||1;t=t||0;Math.seed=(Math.seed*9301+49297)%233280;var n=Math.seed/233280;return t+n*(e-t)};var e=2*t.sampleRate;var n=t.createBuffer(1,e,t.sampleRate);var r=n.getChannelData(0);for(var i=0;i<e;i++){r[i]=Math.seededRandom()*2-1}return n}();var r=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var i=function(e,t){e.env={attack:t.env?t.env.attack||0:0,decay:t.env?t.env.decay||0:0,sustain:t.env?t.env.sustain||1:1,hold:t.env?t.env.hold||4:4,release:t.env?t.env.release||0:0};e.defaultEnv={attack:t.env?t.env.attack||0:0,decay:t.env?t.env.decay||0:0,sustain:t.env?t.env.sustain||1:1,hold:t.env?t.env.hold||4:4,release:t.env?t.env.release||0:0}};var s=function(e,t){if(!t.filter){return}if(r(t.filter)){t.filter.forEach(function(t){s(e,{filter:t})})}else{t.filter=[t.filter];e.filter=t.filter}};var o=function(e,n){var r=new XMLHttpRequest;r.open("GET",e.source,true);r.responseType="arraybuffer";e.playable--;r.onload=function(){t.decodeAudioData(r.response,function(t){e.decodedBuffer=t;if(n){n()}e.playable++;if(e.playOnLoad){e.play(e.playOnLoadArg)}})};r.send()};var u=function(e,t){if(t.vibrato){e.vibrato={shape:t.vibrato.shape||"sine",speed:t.vibrato.speed||1,magnitude:t.vibrato.magnitude||5,attack:t.vibrato.attack||0}}};var a=function(e,t){if(t.tremolo){e.tremolo={shape:t.tremolo.shape||"sine",speed:t.tremolo.speed||1,magnitude:t.tremolo.magnitude||5,attack:t.tremolo.attack||1}}};var f=function(e,n){if(n.reverb){e.reverb={wet:n.reverb.wet||1};var r=n.reverb.impulse||c.defaultImpulse;var i=new XMLHttpRequest;i.open("GET",r,true);i.responseType="arraybuffer";e.playable--;i.onload=function(){t.decodeAudioData(i.response,function(t){e.reverb.buffer=t;e.playable++;if(e.playOnLoad){e.play(e.playOnLoadArg)}})};i.send()}};var l=function(e,n){console.log("set up mic");getUserMedia({audio:true,video:false},function(r){console.log("got stream");e.nodes=[];e.mediaStreamSource=t.createMediaStreamSource(r);e.nodes.push(e.mediaStreamSource);e.gain=t.createGain();e.gain.gain.value=e.volume;e.nodes.push(e.gain);if(e.filter){g(e,n)}if(e.reverb){e.reverb.node=t.createConvolver();e.reverb.node.buffer=e.reverb.buffer;e.reverb.gain=t.createGain();e.reverb.gain.gain.value=e.reverb.wet;e.nodes.push(e.reverb.node);e.nodes.push(e.reverb.gain)}if(e.panning){e.panning.node=t.createPanner();e.panning.node.setPosition(e.panning.location[0],e.panning.location[1],e.panning.location[2]);e.nodes.push(e.panning.node)}console.log(e)},function(e){console.log(e)})};var c=function(e){this.source=e.source;this.destination=e.destination||t.destination;this.volume=e.volume||1;this.defaultVolume=this.volume;this.playable=1;this.pitch=c.pitches[e.pitch]||e.pitch||440;this.globalReverb=e.globalReverb||false;this.gain=[];i(this,e);s(this,e);u(this,e);a(this,e);f(this,e);this.constructExternalFx(e,t);if("panning"in e){if(typeof e.panning==="number"){this.panning={location:[e.panning,0,0]}}else{this.panning={location:[e.panning[0],e.panning[1],e.panning[2]]}}}else{this.panning={location:[0,0,0]}}if(this.source==="noise"){this.decodedBuffer=n}else if(this.source==="mic"){l(this,e)}else if(!(this.source in{sine:0,sawtooth:0,square:0,triangle:0})){o(this,e.callback)}};var h=function(e,n){e.filter.forEach(function(e,r){e.node.frequency.linearRampToValueAtTime(e.frequency,t.currentTime+n.wait);e.node.frequency.linearRampToValueAtTime(e.env.frequency,t.currentTime+e.env.attack+n.wait)})};var p=function(e,n){e.gain[0].gain.linearRampToValueAtTime(1e-4,t.currentTime+n.wait);e.gain[0].gain.linearRampToValueAtTime(e.volume,t.currentTime+e.env.attack+n.wait);e.gain[0].gain.linearRampToValueAtTime(e.volume*e.env.sustain,t.currentTime+e.env.attack+e.env.decay+n.wait);e.gain[0].gain.linearRampToValueAtTime(1e-4,t.currentTime+e.env.attack+e.env.decay+e.env.hold+e.env.release+n.wait);e.soundSource.start(t.currentTime+n.wait);e.soundSource.stop(t.currentTime+e.env.attack+e.env.decay+e.env.hold+e.env.release+n.wait)};var d=function(e){for(var t=1;t<e.nodes.length;t++){e.nodes[t-1].connect(e.nodes[t]);if(e.nodes[t]instanceof ConvolverNode){e.nodes[t-1].connect(e.nodes[t+2])}}e.nodes[e.nodes.length-1].connect(e.destination);if(c.reverb&&e.globalReverb){e.nodes[e.nodes.length-1].connect(c.reverb.node);c.reverb.node.connect(c.reverb.gain);c.reverb.gain.connect(e.destination)}};var v=function(e,n){e.soundSource=t.createOscillator();e.soundSource.type=e.source;if(n&&n.pitch){if(n.pitch in c.pitches){e.soundSource.frequency.value=c.pitches[n.pitch]}else{e.soundSource.frequency.value=n.pitch}}else{e.soundSource.frequency.value=e.pitch}};var m=function(e,t){if(t&&t.env){e.env.attack=t.env.attack||e.defaultEnv.attack;e.env.decay=t.env.decay||e.defaultEnv.decay;e.env.sustain=t.env.sustain||e.defaultEnv.sustain;e.env.hold=t.env.hold||e.defaultEnv.hold;e.env.release=t.env.release||e.defaultEnv.release}else{e.env={attack:e.defaultEnv.attack,decay:e.defaultEnv.decay,sustain:e.defaultEnv.sustain,hold:e.defaultEnv.hold,release:e.defaultEnv.release}}};var g=function(e,n){console.log("arg ",n);e.filter.forEach(function(r,i){console.log(r);r.node=t.createBiquadFilter();console.log(r);r.node.type=r.type;r.node.frequency.value=n.filter[i]?n.filter[i].frequency||r.frequency:r.frequency;r.node.Q.value=n.filter[i]?n.filter[i].q||r.q:r.q;if(n.filter[i].env||e.filter[i].env&&!(e.source==="mic")){r.env={attack:n.filter[i].env.attack||e.filter[i].env.attack,frequency:n.filter[i].env.frequency||e.filter[i].env.frequency}}e.nodes.push(r.node)})};var y=function(e,t){if(t&&t.filter&&e.filter){if(!r(t.filter))t.filter=[t.filter];g(e,t)}else if(e.filter){g(e,e)}};var b=function(e,n){e.reverb.node=t.createConvolver();e.reverb.node.buffer=e.reverb.buffer;e.reverb.gain=t.createGain();e.reverb.gain.gain.value=e.reverb.wet;e.nodes.push(e.reverb.node);e.nodes.push(e.reverb.gain)};var w=function(e,n){if(n&&n.panning||e.panning){e.panning.node=t.createPanner();if(n&&n.panning){if(typeof n.panning==="number"){var r=[n.panning,0,0]}else{var r=[n.panning[0],n.panning[1],n.panning[2]]}}else{var r=[0,0,0]}e.panning.node.setPosition(r[0],r[1],r[2]);e.nodes.push(e.panning.node)}};var E=function(e,t){e.vibrato.wad=new c({source:e.vibrato.shape,pitch:e.vibrato.speed,volume:e.vibrato.magnitude,env:{attack:e.vibrato.attack},destination:e.soundSource.frequency});e.vibrato.wad.play()};var S=function(e,t){e.tremolo.wad=new c({source:e.tremolo.shape,pitch:e.tremolo.speed,volume:e.tremolo.magnitude,env:{attack:e.tremolo.attack},destination:e.gain[0].gain});e.tremolo.wad.play()};c.prototype.constructExternalFx=function(e,t){};c.prototype.setUpExternalFxOnPlay=function(e,t){};c.prototype.play=function(e){if(this.playable<1){this.playOnLoad=true;this.playOnLoadArg=e}else if(this.source==="mic"){console.log("mic play");d(this)}else{this.nodes=[];if(e&&!e.wait){e.wait=0}if(!e){var e={wait:0}}if(e&&e.volume){this.volume=e.volume}else{this.volume=this.defaultVolume}if(this.source in{sine:0,sawtooth:0,square:0,triangle:0}){v(this,e)}else{this.soundSource=t.createBufferSource();this.soundSource.buffer=this.decodedBuffer;if(this.source==="noise"){this.soundSource.loop=true}}this.nodes.push(this.soundSource);m(this,e);y(this,e);this.setUpExternalFxOnPlay(e,t);this.gain.unshift(t.createGain());this.gain[0].label=e.label;this.nodes.push(this.gain[0]);if(this.reverb){b(this,e)}w(this,e);d(this);if(this.filter&&this.filter.env){h(this,e)}p(this,e);if(this.vibrato){E(this,e)}if(this.tremolo){S(this,e)}}};c.prototype.setVolume=function(e){this.defaultVolume=e;if(this.gain.length>0){this.gain[0].gain.value=e}};c.prototype.setPanning=function(e){if(typeof e==="number"){this.panning.node.setPosition(e,this.panning.location[1],this.panning.location[2])}else{this.panning.node.setPosition(e[0],e[1],e[2])}};c.prototype.stop=function(e){if(!(this.source==="mic")){if(e){for(var n=0;n<this.gain.length;n++){if(this.gain[n].label===e){this.gain[n].gain.linearRampToValueAtTime(1e-4,t.currentTime+this.env.release)}}}this.gain[0].gain.linearRampToValueAtTime(1e-4,t.currentTime+this.env.release)}else{this.mediaStreamSource.disconnect(0)}};c.defaultImpulse="http://www.codecur.io/us/sendaudio/widehall.wav";c.setGlobalReverb=function(e){c.reverb={};c.reverb.node=t.createConvolver();c.reverb.gain=t.createGain();c.reverb.gain.gain.value=e.wet;var n=e.impulse||c.defaultImpulse;var r=new XMLHttpRequest;r.open("GET",n,true);r.responseType="arraybuffer";r.onload=function(){t.decodeAudioData(r.response,function(e){c.reverb.node.buffer=e})};r.send()};c.pitches={A0:27.5,"A#0":29.1352,Bb0:29.1352,B0:30.8677,C1:32.7032,"C#1":34.6478,Db1:34.6478,D1:36.7081,"D#1":38.8909,Eb1:38.8909,E1:41.2034,F1:43.6535,"F#1":46.2493,Gb1:46.2493,G1:48.9994,"G#1":51.9131,Ab1:51.9131,A1:55,"A#1":58.2705,Bb1:58.2705,B1:61.7354,C2:65.4064,"C#2":69.2957,Db2:69.2957,D2:73.4162,"D#2":77.7817,Eb2:77.7817,E2:82.4069,F2:87.3071,"F#2":92.4986,Gb2:92.4986,G2:97.9989,"G#2":103.826,Ab2:103.826,A2:110,"A#2":116.541,Bb2:116.541,B2:123.471,C3:130.813,"C#3":138.591,Db3:138.591,D3:146.832,"D#3":155.563,Eb3:155.563,E3:164.814,F3:174.614,"F#3":184.997,Gb3:184.997,G3:195.998,"G#3":207.652,Ab3:207.652,A3:220,"A#3":233.082,Bb3:233.082,B3:246.942,C4:261.626,"C#4":277.183,Db4:277.183,D4:293.665,"D#4":311.127,Eb4:311.127,E4:329.628,F4:349.228,"F#4":369.994,Gb4:369.994,G4:391.995,"G#4":415.305,Ab4:415.305,A4:440,"A#4":466.164,Bb4:466.164,B4:493.883,C5:523.251,"C#5":554.365,Db5:554.365,D5:587.33,"D#5":622.254,Eb5:622.254,E5:659.255,F5:698.456,"F#5":739.989,Gb5:739.989,G5:783.991,"G#5":830.609,Ab5:830.609,A5:880,"A#5":932.328,Bb5:932.328,B5:987.767,C6:1046.5,"C#6":1108.73,Db6:1108.73,D6:1174.66,"D#6":1244.51,Eb6:1244.51,E6:1318.51,F6:1396.91,"F#6":1479.98,Gb6:1479.98,G6:1567.98,"G#6":1661.22,Ab6:1661.22,A6:1760,"A#6":1864.66,Bb6:1864.66,B6:1975.53,C7:2093,"C#7":2217.46,Db7:2217.46,D7:2349.32,"D#7":2489.02,Eb7:2489.02,E7:2637.02,F7:2793.83,"F#7":2959.96,Gb7:2959.96,G7:3135.96,"G#7":3322.44,Ab7:3322.44,A7:3520,"A#7":3729.31,Bb7:3729.31,B7:3951.07,C8:4186.01};c.pitchesArray=["C0","C#0","D0","D#0","E0","F0","F#0","G0","G#0","A0","A#0","B0","C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5","C6","C#6","D6","D#6","E6","F6","F#6","G6","G#6","A6","A#6","B6","C7","C#7","D7","D#7","E7","F7","F#7","G7","G#7","A7","A#7","B7","C8"];c.midiInstrument={play:function(){console.log("playing midi")},stop:function(){console.log("stopping midi")}};c.midiMaps=[];c.midiMaps[0]=function(e){console.log(e.receivedTime,e.data);if(e.data[0]===144){console.log("note");if(e.data[2]===0){c.midiInstrument.stop(c.pitchesArray[e.data[1]])}else if(e.data[2]>0){console.log(c.pitchesArray[e.data[1]]);c.midiInstrument.play({pitch:c.pitchesArray[e.data[1]],label:c.pitchesArray[e.data[1]]})}}else if(e.data[0]===176){console.log("controller")}else if(e.data[0]===224){console.log("pitch bend")}};var x=null;var T=function(e){console.log("got midi access");x=e;var t=x.inputs();for(var n=0;n<t.length;n++){t[n].onmidimessage=c.midiMaps[n]}};var N=function(e){console.log("uh-oh! Something went wrong!  Error code: "+e.code)};try{navigator.requestMIDIAccess().then(T,N)}catch(C){var k="There was an error on this page.\n\n";k+="Error description: "+C.message+"\n\n";k+="Click OK to continue.\n\n";console.log(k)}c.presets={hiHatClosed:{source:"noise",env:{attack:.001,decay:.008,sustain:.2,hold:.03,release:.01},filter:{type:"highpass",frequency:400,q:1}},snare:{source:"noise",env:{attack:.001,decay:.01,sustain:.2,hold:.03,release:.02},filter:{type:"bandpass",frequency:300,q:.18}},hiHatOpen:{source:"noise",env:{attack:.001,decay:.008,sustain:.2,hold:.43,release:.01},filter:{type:"highpass",frequency:100,q:.2}},ghost:{source:"square",volume:.3,env:{attack:.01,decay:.002,sustain:.5,hold:2.5,release:.3},filter:{type:"lowpass",frequency:600,q:7,env:{attack:.7,frequency:1600}},vibrato:{attack:8,speed:8,magnitude:100}},piano:{source:"square",volume:1.4,env:{attack:.01,decay:.005,sustain:.2,hold:.015,release:.3},filter:{type:"lowpass",frequency:1200,q:8.5,env:{attack:.2,frequency:600}}}};return c}()